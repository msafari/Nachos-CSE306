/* Tries to max out the virtual memory space to see what happens */
/* Has a little but more debugging information, but relys of files */
/* working correctly and maxmem2.data being initialized correctly */

#include "syscall.h"

/* This array is 74*200 = 14800 bytes, which should be pretty big. */
#define STR "\
000 0123456789012345678901234567890123456789012345678901234567890123456789\
001 0123456789012345678901234567890123456789012345678901234567890123456789\
002 0123456789012345678901234567890123456789012345678901234567890123456789\
003 0123456789012345678901234567890123456789012345678901234567890123456789\
004 0123456789012345678901234567890123456789012345678901234567890123456789\
005 0123456789012345678901234567890123456789012345678901234567890123456789\
006 0123456789012345678901234567890123456789012345678901234567890123456789\
007 0123456789012345678901234567890123456789012345678901234567890123456789\
008 0123456789012345678901234567890123456789012345678901234567890123456789\
009 0123456789012345678901234567890123456789012345678901234567890123456789\
010 0123456789012345678901234567890123456789012345678901234567890123456789\
011 0123456789012345678901234567890123456789012345678901234567890123456789\
012 0123456789012345678901234567890123456789012345678901234567890123456789\
013 0123456789012345678901234567890123456789012345678901234567890123456789\
014 0123456789012345678901234567890123456789012345678901234567890123456789\
015 0123456789012345678901234567890123456789012345678901234567890123456789\
016 0123456789012345678901234567890123456789012345678901234567890123456789\
017 0123456789012345678901234567890123456789012345678901234567890123456789\
018 0123456789012345678901234567890123456789012345678901234567890123456789\
019 0123456789012345678901234567890123456789012345678901234567890123456789\
020 0123456789012345678901234567890123456789012345678901234567890123456789\
021 0123456789012345678901234567890123456789012345678901234567890123456789\
022 0123456789012345678901234567890123456789012345678901234567890123456789\
023 0123456789012345678901234567890123456789012345678901234567890123456789\
024 0123456789012345678901234567890123456789012345678901234567890123456789\
025 0123456789012345678901234567890123456789012345678901234567890123456789\
026 0123456789012345678901234567890123456789012345678901234567890123456789\
027 0123456789012345678901234567890123456789012345678901234567890123456789\
028 0123456789012345678901234567890123456789012345678901234567890123456789\
029 0123456789012345678901234567890123456789012345678901234567890123456789\
030 0123456789012345678901234567890123456789012345678901234567890123456789\
031 0123456789012345678901234567890123456789012345678901234567890123456789\
032 0123456789012345678901234567890123456789012345678901234567890123456789\
033 0123456789012345678901234567890123456789012345678901234567890123456789\
034 0123456789012345678901234567890123456789012345678901234567890123456789\
035 0123456789012345678901234567890123456789012345678901234567890123456789\
036 0123456789012345678901234567890123456789012345678901234567890123456789\
037 0123456789012345678901234567890123456789012345678901234567890123456789\
038 0123456789012345678901234567890123456789012345678901234567890123456789\
039 0123456789012345678901234567890123456789012345678901234567890123456789\
040 0123456789012345678901234567890123456789012345678901234567890123456789\
041 0123456789012345678901234567890123456789012345678901234567890123456789\
042 0123456789012345678901234567890123456789012345678901234567890123456789\
043 0123456789012345678901234567890123456789012345678901234567890123456789\
044 0123456789012345678901234567890123456789012345678901234567890123456789\
045 0123456789012345678901234567890123456789012345678901234567890123456789\
046 0123456789012345678901234567890123456789012345678901234567890123456789\
047 0123456789012345678901234567890123456789012345678901234567890123456789\
048 0123456789012345678901234567890123456789012345678901234567890123456789\
049 0123456789012345678901234567890123456789012345678901234567890123456789\
050 0123456789012345678901234567890123456789012345678901234567890123456789\
051 0123456789012345678901234567890123456789012345678901234567890123456789\
052 0123456789012345678901234567890123456789012345678901234567890123456789\
053 0123456789012345678901234567890123456789012345678901234567890123456789\
054 0123456789012345678901234567890123456789012345678901234567890123456789\
055 0123456789012345678901234567890123456789012345678901234567890123456789\
056 0123456789012345678901234567890123456789012345678901234567890123456789\
057 0123456789012345678901234567890123456789012345678901234567890123456789\
058 0123456789012345678901234567890123456789012345678901234567890123456789\
059 0123456789012345678901234567890123456789012345678901234567890123456789\
060 0123456789012345678901234567890123456789012345678901234567890123456789\
061 0123456789012345678901234567890123456789012345678901234567890123456789\
062 0123456789012345678901234567890123456789012345678901234567890123456789\
063 0123456789012345678901234567890123456789012345678901234567890123456789\
064 0123456789012345678901234567890123456789012345678901234567890123456789\
065 0123456789012345678901234567890123456789012345678901234567890123456789\
066 0123456789012345678901234567890123456789012345678901234567890123456789\
067 0123456789012345678901234567890123456789012345678901234567890123456789\
068 0123456789012345678901234567890123456789012345678901234567890123456789\
069 0123456789012345678901234567890123456789012345678901234567890123456789\
070 0123456789012345678901234567890123456789012345678901234567890123456789\
071 0123456789012345678901234567890123456789012345678901234567890123456789\
072 0123456789012345678901234567890123456789012345678901234567890123456789\
073 0123456789012345678901234567890123456789012345678901234567890123456789\
074 0123456789012345678901234567890123456789012345678901234567890123456789\
075 0123456789012345678901234567890123456789012345678901234567890123456789\
076 0123456789012345678901234567890123456789012345678901234567890123456789\
077 0123456789012345678901234567890123456789012345678901234567890123456789\
078 0123456789012345678901234567890123456789012345678901234567890123456789\
079 0123456789012345678901234567890123456789012345678901234567890123456789\
080 0123456789012345678901234567890123456789012345678901234567890123456789\
081 0123456789012345678901234567890123456789012345678901234567890123456789\
082 0123456789012345678901234567890123456789012345678901234567890123456789\
083 0123456789012345678901234567890123456789012345678901234567890123456789\
084 0123456789012345678901234567890123456789012345678901234567890123456789\
085 0123456789012345678901234567890123456789012345678901234567890123456789\
086 0123456789012345678901234567890123456789012345678901234567890123456789\
087 0123456789012345678901234567890123456789012345678901234567890123456789\
088 0123456789012345678901234567890123456789012345678901234567890123456789\
089 0123456789012345678901234567890123456789012345678901234567890123456789\
090 0123456789012345678901234567890123456789012345678901234567890123456789\
091 0123456789012345678901234567890123456789012345678901234567890123456789\
092 0123456789012345678901234567890123456789012345678901234567890123456789\
093 0123456789012345678901234567890123456789012345678901234567890123456789\
094 0123456789012345678901234567890123456789012345678901234567890123456789\
095 0123456789012345678901234567890123456789012345678901234567890123456789\
096 0123456789012345678901234567890123456789012345678901234567890123456789\
097 0123456789012345678901234567890123456789012345678901234567890123456789\
098 0123456789012345678901234567890123456789012345678901234567890123456789\
099 0123456789012345678901234567890123456789012345678901234567890123456789\
100 0123456789012345678901234567890123456789012345678901234567890123456789\
101 0123456789012345678901234567890123456789012345678901234567890123456789\
102 0123456789012345678901234567890123456789012345678901234567890123456789\
103 0123456789012345678901234567890123456789012345678901234567890123456789\
104 0123456789012345678901234567890123456789012345678901234567890123456789\
105 0123456789012345678901234567890123456789012345678901234567890123456789\
106 0123456789012345678901234567890123456789012345678901234567890123456789\
107 0123456789012345678901234567890123456789012345678901234567890123456789\
108 0123456789012345678901234567890123456789012345678901234567890123456789\
109 0123456789012345678901234567890123456789012345678901234567890123456789\
110 0123456789012345678901234567890123456789012345678901234567890123456789\
111 0123456789012345678901234567890123456789012345678901234567890123456789\
112 0123456789012345678901234567890123456789012345678901234567890123456789\
113 0123456789012345678901234567890123456789012345678901234567890123456789\
114 0123456789012345678901234567890123456789012345678901234567890123456789\
115 0123456789012345678901234567890123456789012345678901234567890123456789\
116 0123456789012345678901234567890123456789012345678901234567890123456789\
117 0123456789012345678901234567890123456789012345678901234567890123456789\
118 0123456789012345678901234567890123456789012345678901234567890123456789\
119 0123456789012345678901234567890123456789012345678901234567890123456789\
120 0123456789012345678901234567890123456789012345678901234567890123456789\
121 0123456789012345678901234567890123456789012345678901234567890123456789\
122 0123456789012345678901234567890123456789012345678901234567890123456789\
123 0123456789012345678901234567890123456789012345678901234567890123456789\
124 0123456789012345678901234567890123456789012345678901234567890123456789\
125 0123456789012345678901234567890123456789012345678901234567890123456789\
126 0123456789012345678901234567890123456789012345678901234567890123456789\
127 0123456789012345678901234567890123456789012345678901234567890123456789\
128 0123456789012345678901234567890123456789012345678901234567890123456789\
129 0123456789012345678901234567890123456789012345678901234567890123456789\
130 0123456789012345678901234567890123456789012345678901234567890123456789\
131 0123456789012345678901234567890123456789012345678901234567890123456789\
132 0123456789012345678901234567890123456789012345678901234567890123456789\
133 0123456789012345678901234567890123456789012345678901234567890123456789\
134 0123456789012345678901234567890123456789012345678901234567890123456789\
135 0123456789012345678901234567890123456789012345678901234567890123456789\
136 0123456789012345678901234567890123456789012345678901234567890123456789\
137 0123456789012345678901234567890123456789012345678901234567890123456789\
138 0123456789012345678901234567890123456789012345678901234567890123456789\
139 0123456789012345678901234567890123456789012345678901234567890123456789\
140 0123456789012345678901234567890123456789012345678901234567890123456789\
141 0123456789012345678901234567890123456789012345678901234567890123456789\
142 0123456789012345678901234567890123456789012345678901234567890123456789\
143 0123456789012345678901234567890123456789012345678901234567890123456789\
144 0123456789012345678901234567890123456789012345678901234567890123456789\
145 0123456789012345678901234567890123456789012345678901234567890123456789\
146 0123456789012345678901234567890123456789012345678901234567890123456789\
147 0123456789012345678901234567890123456789012345678901234567890123456789\
148 0123456789012345678901234567890123456789012345678901234567890123456789\
149 0123456789012345678901234567890123456789012345678901234567890123456789\
150 0123456789012345678901234567890123456789012345678901234567890123456789\
151 0123456789012345678901234567890123456789012345678901234567890123456789\
152 0123456789012345678901234567890123456789012345678901234567890123456789\
153 0123456789012345678901234567890123456789012345678901234567890123456789\
154 0123456789012345678901234567890123456789012345678901234567890123456789\
155 0123456789012345678901234567890123456789012345678901234567890123456789\
156 0123456789012345678901234567890123456789012345678901234567890123456789\
157 0123456789012345678901234567890123456789012345678901234567890123456789\
158 0123456789012345678901234567890123456789012345678901234567890123456789\
159 0123456789012345678901234567890123456789012345678901234567890123456789\
160 0123456789012345678901234567890123456789012345678901234567890123456789\
161 0123456789012345678901234567890123456789012345678901234567890123456789\
162 0123456789012345678901234567890123456789012345678901234567890123456789\
163 0123456789012345678901234567890123456789012345678901234567890123456789\
164 0123456789012345678901234567890123456789012345678901234567890123456789\
165 0123456789012345678901234567890123456789012345678901234567890123456789\
166 0123456789012345678901234567890123456789012345678901234567890123456789\
167 0123456789012345678901234567890123456789012345678901234567890123456789\
168 0123456789012345678901234567890123456789012345678901234567890123456789\
169 0123456789012345678901234567890123456789012345678901234567890123456789\
170 0123456789012345678901234567890123456789012345678901234567890123456789\
171 0123456789012345678901234567890123456789012345678901234567890123456789\
172 0123456789012345678901234567890123456789012345678901234567890123456789\
173 0123456789012345678901234567890123456789012345678901234567890123456789\
174 0123456789012345678901234567890123456789012345678901234567890123456789\
175 0123456789012345678901234567890123456789012345678901234567890123456789\
176 0123456789012345678901234567890123456789012345678901234567890123456789\
177 0123456789012345678901234567890123456789012345678901234567890123456789\
178 0123456789012345678901234567890123456789012345678901234567890123456789\
179 0123456789012345678901234567890123456789012345678901234567890123456789\
180 0123456789012345678901234567890123456789012345678901234567890123456789\
181 0123456789012345678901234567890123456789012345678901234567890123456789\
182 0123456789012345678901234567890123456789012345678901234567890123456789\
183 0123456789012345678901234567890123456789012345678901234567890123456789\
184 0123456789012345678901234567890123456789012345678901234567890123456789\
185 0123456789012345678901234567890123456789012345678901234567890123456789\
186 0123456789012345678901234567890123456789012345678901234567890123456789\
187 0123456789012345678901234567890123456789012345678901234567890123456789\
188 0123456789012345678901234567890123456789012345678901234567890123456789\
189 0123456789012345678901234567890123456789012345678901234567890123456789\
190 0123456789012345678901234567890123456789012345678901234567890123456789\
191 0123456789012345678901234567890123456789012345678901234567890123456789\
192 0123456789012345678901234567890123456789012345678901234567890123456789\
193 0123456789012345678901234567890123456789012345678901234567890123456789\
194 0123456789012345678901234567890123456789012345678901234567890123456789\
195 0123456789012345678901234567890123456789012345678901234567890123456789\
196 0123456789012345678901234567890123456789012345678901234567890123456789\
197 0123456789012345678901234567890123456789012345678901234567890123456789\
198 0123456789012345678901234567890123456789012345678901234567890123456789\
199 0123456789012345678901234567890123456789012345678901234567890123456789\
"

#define MSG1 "Program started\n"
#define MSG2 "Program ended\n"
#define ERR "Probably couldn't spawn child\n"

int main() {
    char buf[10];
    char* str = STR;
    int fd, i, pid;
    
    for(i=0; i < 7; i++)
	buf[i] = '0';
    
    fd = Open("maxmem2.data");
    if(fd >= 0) {
	Read(buf, 7, fd);
	Close(fd);
    }
    /* Add one to the count */
    for(i=6; i >= 0; i--)
	if(++buf[i] > '9')
	    buf[i] = '0';
        else
	    break;

    buf[7] = ' ';
    Write(buf, 8, ConsoleOutput);
    Write(MSG1, sizeof(MSG1)-1, ConsoleOutput);

    Create("maxmem2.data");
    fd = Open("maxmem2.data");
    Write(buf, 7, fd);
    Close(fd);
	
    pid = Exec("maxmem2");
    if(pid >= 0)
	Join(pid);
    else
	Write(ERR, sizeof(ERR)-1, ConsoleOutput);

    Write(buf, 8, ConsoleOutput);
    Write(MSG2, sizeof(MSG2)-1, ConsoleOutput);

    Exit(0);
}
